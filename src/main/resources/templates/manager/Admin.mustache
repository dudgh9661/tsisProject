<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- <link rel="stylesheet" href="main.css"/> -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"
        integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="css/common.css">
    <title>Document</title>
</head>

<body>

    <!--sidebar-->
    <div class="sidebar">
        <a href="03_Main.html">
            <img src="img/tsis.png" class="logo" />
        </a>
        <ul class="sidebar_ul">
            <li>
                <a href="04_RecommendationEdu.html">추천 강좌 보기</a>
            </li>
            <li>
                <a href="05_SubjectEdu.html">주제별 교육 검색</a>
            </li>
            <li>
                <a href="06_AcademyEdu.html">기관별 교육 검색</a>
            </li>
            <li>
                <a href="07_SelectEdu.html">주요 교육기관</a>
            </li>
            <li>
                <a href="08_LegendEdu.html">교육 주제 범례</a>
            </li>
            <li>
                <a href="09_AdminMain.html">관리자</a>
            </li>
        </ul>
    </div>
    <!--/sidebar-->

    <!--content-->
    <div class="content">
        <!--header-->
        <header>
            <div class="login-info">
                <span>죠르디님 환영합니다!</span>
                <button type="button" class="logout">
                    <a href="01_Index.html">
                        로그아웃
                    </a>
                </button>
            </div>
        </header>
        <!--header-->

        <!--section-->
        <section>
            <div>
                <p class="style-title">관리자 권한 관리</p>
            

            <div class="total-box">
                <table>
                    <tr>
                        <td>
                            <div style="text-align: center;">
                                <input class="inputInfo" placeholder="이름 또는 사번 입력"> 
                                <button type="button" class="btn gr" id="btnSearch">조회</button>
                            </div>
                        </td>
                        <td></td>
                        <td>
                            <div style="text-align: center;">
                                <p class="style-subject">관리자 목록</p>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="left-userTable">
                                <table border="1" class="styled-table" id="userTable">
                                    <tr>
                                        <th>선택</th>
                                        <th>이름</th>
                                        <th>부서</th>
                                        <th>직급</th>
                                        <th>연차</th>
                                        <th>사번</th>
                                    </tr>
                                    <tbody id="empInfo">

                                        {{#emps}}
                                            <tr>
                                                <td><input type="checkbox" name="user-checkbox"></td>
                                                <td>{{emp_name}}</td>
                                                <td>{{emp_team}}</td>
                                                <td>{{emp_position}}</td>
                                                <td>{{emp_years}}년차</td>
                                                <td>{{emp_id}}</td>
                                            </tr>
                                        {{/emps}}
                                        </tbody>
        
                                </table>
                            </div>
                        </td>
                        <td>
                            <div class="btnGrp">
                                <button class="btn gr" id="btnAdd">▶</button>
                                <br /> <br />
        
                                <button class="btn gr" id="btnCancel">◀</button>
                            </div>
                        </td>
                        <td>
                            <div class="right-managerTable">
                            
                                <table border="1" class="styled-table" id="managerTable">
                                    <tr>
                                        <th>선택</th>
                                        <th>이름</th>
                                        <th>부서</th>
                                        <th>직급</th>
                                        <th>연차</th>
                                        <th>사번</th>
                                    </tr>
                                    {{#managers}}
                                    <tr>
                                        <td><input type="checkbox" name="manager-checkbox"></td>
                                        <td>{{emp_name}}</td>
                                        <td>{{emp_team}}</td>
                                        <td>{{emp_position}}</td>
                                        <td>{{emp_years}}년차</td>
                                        <td>{{emp_id}}</td>
                                    </tr>
                                    {{/managers}}
                                </table>
                            </div>
        
                        </td>
                    </tr>
        
                </table>
            </div>
        </div>
        </section>
        <!--/section-->

        <!--footer-->
        <footer>
            <div class="footer-info">
                <div>
                    <p>문의처</p>
                </div>
                <div>
                    <p>교육담당자 | 인사팀 정병석 과장</p>
                </div>
            </div>
    </div>
    </footer>
    <!--/footer-->
    </div>
    <!--content-->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script type="text/javascript" src="C:/Users/Emily Choi/Desktop/Workspace/js/jquery.ajax-cross-origin.min.js"></script>
        <script>
            $(function () {
                $('#userTable tr').on({
                    mouseenter: function () {
                        $(this).css('background-color', 'lightgray')
                    },
                    mouseleave: function () {
                        $(this).css('background-color', '')
                    }
                });

                $('#managerTable tr').hover(function(){
                    $(this).css({
                        background:'lightgray'
                    });
                },function(){
                        $(this).css({
                            background:''
                        })
                    }
                ); 
                // $('#userTable tr').click(function () {
                //     alert($(this).text())
                // });
                // > 버튼 클릭
                $('#btnAdd').click(function(){
                    var checkbox = $("input[name=user-checkbox]:checked");
                
                    const userTable = document.getElementById('userTable');
                    const managerTable = document.getElementById('managerTable');

                    const ids = [];
                    checkbox.each(function(i){
                    
                        var tr = $(this).parent().parent();
                        $(this).attr("name", "manager-checkbox");
                        $(this).prop("checked", false);
                        $("#managerTable tbody").append(tr);

                        var emp_id = $(tr).find('td:last-child')[0].innerHTML;
                        ids.push(emp_id);
                    })
                    console.log(ids);

                    $.ajax({
                            url: "/admin/setAdmin", 
                            method: "POST",
                            data: ids,
                            dataType: "json",
                            success: function (data) {
                                console.log(data);
                                
                            },
                            error: function (x, s, e) {
                                console.log(x, s, e);
                            }
                        });
                })

                $('#btnCancel').click(function(){
                    var checkbox = $("input[name=manager-checkbox]:checked");
                
                    const userTable = document.getElementById('userTable');
                    const managerTable = document.getElementById('managerTable');

                    const ids = [];

                    checkbox.each(function(i){
                    
                        var tr = $(this).parent().parent();
                        $(this).attr("name", "user-checkbox");
                        $(this).prop("checked", false);

                        var emp_id = $(tr).find('td:last-child')[0].innerHTML;
                        ids.push(emp_id);
                        tr.remove();
                        //$("#userTable tbody").append(tr);
                    })

                    console.log(ids);

                    $.ajax({
                            url: "/admin/delAdmin", 
                            method: "POST",
                            data: ids,
                            dataType: "json",
                            success: function (data) {
                                console.log(data);
                                
                            },
                            error: function (x, s, e) {
                                console.log(x, s, e);
                            }
                        });
                })

                $('#btnSearch').click(function(){

                    $.ajax({
                        url: "/json/employee.json", 
                        method: "GET",
                        data: "",
                        dataType: "json",
                        success: function (data) {
                            console.log(data);
                            $('#empInfo').empty();
                            $.each(data.employees, function(index,item){
                                $('#empInfo').append('<tr><td><input type="checkbox" name="user-checkbox"></td>'+
                                        '<td>'+item.emp_name+'</td><td>'+item.emp_team+'</td><td>'+item.emp_position+'</td>'+
                                        '<td>'+item.emp_years+'년차</td><td>'+item.emp_id+'</td></tr>')
                            });
                        },
                        error: function (x, s, e) {
                            console.log(x, s, e);
                        }
                    });
                    
                    var searchValue = $(".inputInfo").val();
                    
                    // $.ajax({
                    //     url: "/admin/getUser", 
                    //     method: "POST",
                    //     data: {"searchValue": searchValue},
                    //     dataType: "json",
                    //     success: function (data) {
                    //         console.log(data);
                    //         $('#empInfo').empty();
                    //         $.each(data.employees, function(index,item){
                    //             $('#empInfo').append('<tr><td><input type="checkbox" name="user-checkbox"></td>'+
                    //                     '<td>'+item.emp_name+'</td><td>'+item.emp_team+'</td><td>'+item.emp_position+'</td>'+
                    //                     '<td>'+item.emp_years+'년차</td><td>'+item.emp_id+'</td></tr>')
                    //         });
                    //     },
                    //     error: function (x, s, e) {
                    //         console.log(x, s, e);
                    //     }
                    // });



                });             

            })

        </script>
</body>

</html>
